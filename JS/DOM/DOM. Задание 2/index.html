<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Программирование в среде JavaScript</title>
		<style>
			table {
				margin: 0 auto;
				margin-top: 15px;
				border: 1px solid black;
			}
			table * {
				padding: 5px;
			}
			tr:nth-child(1) {
				text-align: center;
				font-weight: bold;
			}
			th, td {
				border: 1px solid black;
			}
			
		</style>
	</head>
	
	<body>
		<header>
			<h1 align = "center">Выбор элементов DOM</h1>
		</header>
		
		<!-- блок для вставки контента -->
		<div class="flights"></div>
		
		<!-- блок для вставки контента -->
		<div class="passengers"></div>
		
		<script>
			// инициализация JS объекта
			obj = {
				"data": {
					"items": [
						{
							"code": "MGERS",
							"cost": 40000,
							"flights": [
								{
									"flight_id": 1,
									"flight_code": "FP2100",
									"from": {
										"city": "Moscow",
										"airport": "Sheremetyevo",
										"iata": "SVO",
										"date": "2020-10-01",
										"time": "08:35"
									},
									"to": {
										"city": "Kazan",
										"airport": "Kazan",
										"iata": "KZN",
										"date": "2020-10-01",
										"time": "10:05"
									},
									"cost": 10500,
									"availability": 58
								},
								{
									"flight_id": 2,
									"flight_code": "FP1200",
									"from": {
										"city": "Kazan",
										"airport": "Kazan",
										"iata": "KZN",
										"date": "2020-10-12",
										"time": "12:00"
									},
									"to": {
										"city": "Moscow",
										"airport": "Sheremetyevo",
										"iata": "SVO",
										"date": "2020-10-12",
										"time": "13:35"
									},
									"cost": 9500,
									"availability": 58
								}
							],
							"passengers": [
								{
									"id": 1,
									"first_name": "Ivan",
									"last_name": "Ivanov",
									"birth_date": "1990-02-20",
									"document_number": "1234567890",
									"place_from": null,
									"place_back": null
								},
								{
									"id": 2,
									"first_name": "Ivan",
									"last_name": "Sergeev",
									"birth_date": "1990-03-20",
									"document_number": "1224567890",
									"place_from": null,
									"place_back": null
								}
							]
						}
					]
				}
			}
			
			//Flights Part
			const flightsData = obj.data.items[0].flights;
			const flightsTableHeaderData = ["Код", "Откуда", "Дата и время вылета", "Куда", "Дата и время прилета", "Цена"];
			const flightsDiv = document.querySelector(".flights");
			
			const table = document.createElement("table");
			
			flightsDiv.append(table);
			
			for (let j = 0; j < flightsData.length + 1; j++) {
				let tableRow = document.createElement("tr");
				table.appendChild(tableRow);
				
				for (let i = 0; i < flightsTableHeaderData.length; i++) {
					let td = document.createElement("td");
					
					if (td.ATTRIBUTE_NODE == 2) {
						td.textContent = flightsTableHeaderData[i];
					}
					tableRow.appendChild(td);
				}
			}
			
			for (let i = 0; i < flightsData.length; i++) {
				let nodes = table.childNodes[i + 1].childNodes
				
				nodes[0].textContent = flightsData[i].flight_code
				nodes[1].textContent = flightsData[i].from.city + ", " + flightsData[i].from.airport + ' (' + flightsData[i].from.iata + ')'
				nodes[2].textContent = flightsData[i].from.date + " " + flightsData[i].from.time
				nodes[3].textContent = flightsData[i].to.city + ", " + flightsData[i].to.airport + ' (' + flightsData[i].to.iata + ')'
				nodes[4].textContent = flightsData[i].to.date + " " + flightsData[i].to.time
				nodes[5].textContent = flightsData[i].cost
			}
			
			//Passengers Part
			const passengersData = obj.data.items[0].passengers;
			const passengersTableHeaderData = ["ID", "Имя", "Дата рождения", "Номер документа"];
			const passengersDiv = document.querySelector(".passengers");
			
			const pTable = document.createElement("table");
			const pTableBody = document.createElement("tbody");
			
			pTable.appendChild(pTableBody);
			passengersDiv.append(pTable);
			
			for (i = 0; i < passengersData.length + 1; i++) {
				let tableRow = document.createElement("tr");
				pTableBody.appendChild(tableRow);
				
				for (j = 0; j < passengersTableHeaderData.length; j++) {
					let td = document.createElement("td");
					
					if (td.ATTRIBUTE_NODE == 2) {
						td.textContent = passengersTableHeaderData[j];
					}
					tableRow.appendChild(td);
				}
			}
			
			for (let i = 0; i < passengersData.length; i++) {
				let nodes = pTableBody.childNodes[i + 1].childNodes
				
				nodes[0].textContent = passengersData[i].id
				nodes[1].textContent = passengersData[i].last_name + " " + passengersData[i].first_name
				nodes[2].textContent = passengersData[i].birth_date
				nodes[3].textContent = passengersData[i].document_number
			}
		</script>
	</body>
</html>